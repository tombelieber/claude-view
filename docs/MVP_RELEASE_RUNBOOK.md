# ðŸš€ MVP Release Runbook â€” Complete Step-by-Step Guide

**Last updated:** 2026-01-29

> Everything you need to do to ship `npx claude-view` and close out the MVP. This is your personal action checklist.

---

## Phase Overview

| Phase | What | Status | Your Role |
|-------|------|--------|-----------|
| **Code** | Phases 1-3.5 complete (backend, frontend, metrics) | âœ… Done | Read only |
| **Setup** | Create npm account, configure Trusted Publisher | â³ Pending | **YOU DO THIS** |
| **CI/Code** | Add checksums, npm publish automation, version checks | ðŸ“ Ready to implement | I'll do this |
| **Validation** | Dry run, build locally, smoke test | âœ… Ready | **YOU DO THIS** |
| **Release** | Tag, push, monitor CI, verify npm, e2e test | ðŸ“‹ Ready | **YOU DO THIS** |

---

## PART 1: One-Time Human Setup (10 minutes)

These steps must complete **before** any code changes. Do them in order.

**Note:** This uses **Trusted Publishing (OIDC)** â€” the modern npm standard that requires zero long-lived secrets. See [npm Trusted Publishers docs](https://docs.npmjs.com/trusted-publishers/) for details.

### Step 1.1: Create or Verify npm Account

Go to **https://www.npmjs.com/** and either:
- Create a new account if you don't have one, verify your email
- Or log in to your existing account

**Verify package name is available:**
```bash
npm view claude-view
```

Should return `404 not found`. If it's taken, use a scoped name like `@your-username/claude-view`.

**âœ“ Done when:** You're logged into npm and confirmed the name is free.

---

### Step 1.2: Configure Trusted Publisher for GitHub

This is a one-time setup that tells npm to trust your GitHub Actions workflow.

1. Log into **https://www.npmjs.com/**
2. Go to your **Account Settings** â†’ **Access Tokens** (or **Security**)
3. Look for **Trusted publishers** section
4. Click **Add a publisher**
5. Select **GitHub Actions** as the publisher type
6. Fill in:
   - **GitHub organization:** `myorg` (your GitHub username/org)
   - **GitHub repository:** `claude-view`
   - **Workflow filename:** `release.yml`
   - **Environment name:** (leave blank or use the environment from your workflow)

7. Click **Create**

**âœ“ Done when:** You see your GitHub publisher listed in the Trusted Publishers section.

**Why this works:** npm now has a trust relationship with your GitHub Actions. Each publish uses a short-lived OIDC token automatically generated by GitHub â€” no secrets needed.

---

### Step 1.3: Verify Repo is Public

npm provenance requires your GitHub repo to be public.

Go to **https://github.com/myorg/claude-view/settings** and check:
- Under "Danger Zone" â†’ is the repo visibility set to **Public**?
- If **Private**, click "Change visibility" and make it public

**âœ“ Done when:** Repo visibility shows "Public".

---

### âœ… Setup Complete

You've done the two things only a human can do:
- âœ“ npm account created/verified
- âœ“ Trusted Publisher configured (GitHub â†’ npm OIDC trust)
- âœ“ GitHub repo is public

No secrets to store, no tokens to manage. npm trusts GitHub Actions directly via OIDC.

**Next step:** Tell me you're done with setup, and I'll implement the CI/code changes.

---

## PART 2: Implementation Tasks (Claude Does This)

Once you signal setup is complete, I will:

### Task 2.1: Add SHA256 Checksums to CI
- Modify `.github/workflows/release.yml`
- Generate `checksums.txt` on each release
- Upload to GitHub Release

### Task 2.2: Add Checksum Verification to npx Wrapper
- Modify `npx-cli/index.js`
- Verify downloaded binary before execution
- Fail gracefully with clear error if checksum doesn't match

### Task 2.3: Add Automated npm Publish to CI
- Append `publish-npm` job to `.github/workflows/release.yml`
- Automatically publish to npm when GitHub Release is created
- Use Trusted Publishing (OIDC) â€” no NPM_TOKEN needed
- Include npm provenance (Sigstore attestation) automatically

### Task 2.4: Add Version Sync Check
- Add CI check that git tag version matches `npx-cli/package.json`
- Prevents version mismatches that break the release

### Task 2.5: Add Release Helper Scripts
- Add `release:bump`, `release:tag`, `release:push` to `package.json`
- Makes future releases as simple as: `bun run release:bump X.Y.Z && bun run release:tag && bun run release:push`

---

## PART 3: Validation (You Do This)

After I implement the code changes, you'll do a dry run.

### Step 3.1: Verify Package Contents

```bash
cd npx-cli
npm pack --dry-run
```

**Check output shows:**
- âœ“ `claude-view/index.js` (the wrapper)
- âœ“ `claude-view/package.json`
- âœ“ `claude-view/README.md`
- âœ“ No source code, no `dist/`, no `crates/`

### Step 3.2: Build Locally

```bash
# Build frontend
bun run build

# Build Rust backend
cargo build --release -p vibe-recall-server
```

Both must succeed without errors.

### Step 3.3: Smoke Test the Binary

```bash
mkdir -p /tmp/cv-staging
cp target/release/vibe-recall /tmp/cv-staging/
cp -r dist /tmp/cv-staging/

# Start the server
STATIC_DIR=/tmp/cv-staging/dist /tmp/cv-staging/vibe-recall
```

**Should see:**
```
Server running at http://127.0.0.1:47892
Ready.
```

Press `Ctrl+C` to stop.

### Step 3.4: Verify Trusted Publisher

Go to **https://www.npmjs.com/** â†’ Account Settings â†’ Trusted Publishers and confirm:
- âœ“ GitHub Actions publisher for `myorg/claude-view/release.yml` is listed

**âœ“ Validation complete when:** All 4 checks pass.

---

## PART 4: Release (You Do This)

You're now ready to ship the MVP.

### Step 4.1: Decide Release Version

For first release, use `0.2.0` (or `0.1.0` if you prefer).

Write this version down: `________`

### Step 4.2: Update Version

```bash
bun run release:bump 0.2.0
```

This automatically updates `npx-cli/package.json` to `0.2.0`.

### Step 4.3: Commit Version Bump

```bash
git add npx-cli/package.json
git commit -m "chore: bump to v0.2.0"
```

### Step 4.4: Tag and Push

```bash
bun run release:tag
bun run release:push
```

This:
1. Creates a git tag `v0.2.0`
2. Pushes commits and tags to GitHub
3. Triggers the CI pipeline automatically

### Step 4.5: Monitor CI

Go to **https://github.com/myorg/claude-view/actions** and watch the release workflow.

**Wait for:**
1. âœ“ `build` job completes (4 platform binaries)
2. âœ“ `release` job completes (GitHub Release created)
3. âœ“ `publish-npm` job completes (npm publish succeeds)

Should take ~3-5 minutes total.

**If any job fails:** Check the logs, fix the issue, and we'll retag.

### Step 4.6: Verify npm

```bash
npm view claude-view
```

**Should show:**
```
claude-view@0.2.0 | MIT | deps: none | versions: 1
```

### Step 4.7: End-to-End Test

```bash
# Clean the cache to force re-download
rm -rf ~/.cache/claude-view

# Install and run
npx claude-view@latest
```

**Should see:**
1. Download starts
2. Checksum verification (if release has checksums)
3. Server starts on `http://127.0.0.1:47892`
4. Opens in browser

**âœ“ Release complete when:** Everything works.

---

## PART 5: Post-Release (Cleanup & Documentation)

After the first release ships, you should:

### 5.1: Update PROGRESS.md

Mark Phase 4 as **DONE**:
```
| Phase 4: Distribution (npx) | **DONE** | v0.2.0 released, auto-publish working | Personal |
```

### 5.2: Create Release Notes

Add to **https://github.com/myorg/claude-view/releases/tag/v0.2.0**:

```markdown
## ðŸŽ‰ vibe-recall v0.2.0 â€” MVP Release

### What's Included
- Full JSONL parser (7-type extraction: assistant, user, tool_use, etc.)
- Parallel indexing (~1.8s for 500 sessions on 8 cores)
- Metrics engine (atomic units, derived metrics, git correlation)
- Full dashboard with filtering, export, trends
- Session deep-dive view with metrics, git commits, files touched
- 335+ backend tests, full TypeScript coverage
- Accessibility audit (WCAG AA compliance)

### Distribution
- `npx claude-view` â€” install with Node.js (zero build tools needed)
- SHA256 checksum verification for integrity
- npm provenance attestation (Sigstore)

### Known Limitations
- macOS ARM64/Intel only (MVP)
- Linux/Windows support in v0.3+
- Search (Tantivy) planned for v0.4+
- Enterprise team layer in Phase 5

### Getting Started
```bash
npx claude-view
```

Open `http://127.0.0.1:47892` in your browser.

### Feedback
Found a bug? Have a feature request? [Open an issue](https://github.com/myorg/claude-view/issues)
```

### 5.3: Announce

Post in your channels (Twitter, blog, Discord, etc.):

> ðŸš€ **vibe-recall v0.2.0 is live!**
>
> Browse & search your Claude Code sessions with:
> ```bash
> npx claude-view
> ```
>
> âœ¨ Features: metrics, trends, git correlation, full-text export
>
> ðŸ“Š 335+ tests, zero dependencies, open-source
>
> GitHub: [myorg/claude-view](https://github.com/myorg/claude-view)

### 5.4: Future Releases

For every release after this one, use the same workflow:

```bash
# 1. Bump version
bun run release:bump X.Y.Z

# 2. Commit
git add npx-cli/package.json
git commit -m "chore: bump to vX.Y.Z"

# 3. Tag and push
bun run release:tag
bun run release:push

# 4. Wait for CI (~5 minutes)
# 5. Verify: npx view claude-view
# 6. Smoke test: rm -rf ~/.cache/claude-view && npx claude-view@latest
```

---

## Quick Reference Checklist

### Before Anything (Setup)
- [ ] npm account created/verified
- [ ] Trusted Publisher configured (GitHub â†’ npm OIDC)
- [ ] GitHub repo is public
- [ ] Tell Claude you're done with setup

### Before Release (Validation)
- [ ] `npm pack --dry-run` shows correct files
- [ ] `bun run build` succeeds
- [ ] `cargo build --release -p vibe-recall-server` succeeds
- [ ] Local smoke test starts server on :47892
- [ ] `NPM_TOKEN` secret exists on GitHub

### Release
- [ ] Decide version number
- [ ] `bun run release:bump X.Y.Z`
- [ ] `git add -A && git commit -m "chore: bump to vX.Y.Z"`
- [ ] `bun run release:tag && bun run release:push`
- [ ] Watch CI at `/actions` (should take ~5 min)
- [ ] `npm view claude-view` shows new version
- [ ] `rm -rf ~/.cache/claude-view && npx claude-view@latest` works

### After Release
- [ ] Update PROGRESS.md (mark Phase 4 DONE)
- [ ] Add release notes to GitHub Release
- [ ] Announce on Twitter/blog/Discord

---

## Troubleshooting

### "npm ERR! 403 Forbidden" during publish
- **Cause:** Trusted Publisher not configured, or workflow file name doesn't match
- **Fix:** Go to https://www.npmjs.com/ â†’ Account Settings â†’ Trusted Publishers and verify:
  - GitHub publisher exists for `myorg/claude-view`
  - Workflow filename is exactly `release.yml`
- **Or:** Check GitHub Actions logs for OIDC token errors

### "Checksum verification FAILED"
- **Cause:** Binary was corrupted during download, or checksums.txt is wrong
- **Fix:** Check GitHub Release has `checksums.txt` file, or retry the download

### "Version mismatch: tag v0.2.0 != package.json 0.1.0"
- **Cause:** You tagged but forgot to bump `npx-cli/package.json` first
- **Fix:** Run `bun run release:bump 0.2.0` and recommit before tagging

### "npm publish fails with 'not authorized'"
- **Cause:** Token has expired (if you set 365-day expiry, might be ~1 year old)
- **Fix:** Generate a new token, update `NPM_TOKEN` secret

### "GitHub Actions fails during build"
- **Check:** https://github.com/myorg/claude-view/actions
- **Click:** Failed job â†’ logs
- **Common issues:**
  - Rust compilation error â†’ run `cargo test` locally
  - TypeScript error â†’ run `bun run build` locally
  - Missing dependency â†’ check `Cargo.toml`, `package.json`

---

## Done! ðŸŽ‰

Once you complete all these steps, `vibe-recall` will be:
- âœ… Open source (public GitHub repo)
- âœ… PII-free (privacy scrub complete)
- âœ… Publicly installable (`npx claude-view`)
- âœ… Integrity-verified (SHA256 checksums)
- âœ… Provenance-attested (npm provenance)
- âœ… Auto-published (CI handles it)

**Next phases (after MVP):**
- **Phase 5:** Enterprise team layer (multi-user aggregation)
- **Phase 6:** Full-text search (Tantivy)
- **v0.3:** Linux + Windows support

---

## Questions?

- **About npm setup?** Check https://docs.npmjs.com/
- **About GitHub secrets?** Check https://docs.github.com/en/actions/security-guides/encrypted-secrets
- **About the code?** Read `docs/plans/2026-01-29-phase4-npx-release.md` for full details

**Ready? Tell me you've completed PART 1 (Setup) and I'll implement PART 2 (Tasks).**
